# 인수인계 기록 (2026-01-11)

## 1. 오늘 완료된 작업 (Phase 20: 링커-페이로드 고도화 v2)

### 1.1 데이터베이스 스키마 확장
- **테이블 확장**: `entity_linkers`, `entity_drugs` 테이블에 화학 구조 및 신뢰도 관련 필드 추가.
  - `smiles`, `inchi_key`, `synonyms`, `structure_source`, `structure_status`, `structure_confidence` 등.
- **신규 테이블 생성**: 문헌 기반 근거 저장을 위한 테이블 구축.
  - `evidence_snippets`: RAG를 통해 추출된 근거 텍스트 및 메타데이터 저장.
  - `entity_evidence_map`: 엔티티(링커/페이로드)와 근거 간의 다대다 매핑.
- **마이그레이션**: `20260111154000_linker_payload_v2_schema.sql` 실행 완료.

### 1.2 백엔드 로직 구현
- **화학 구조 Resolver**: `resolver.ts` 유틸리티 구현.
  - PubChem PUG REST API 및 OPSIN API 연동.
  - 명칭/동의어 기반 SMILES 자동 조회 및 신뢰도 점수 계산 로직 포함.
- **서버 액션**: `admin.ts`에 관리자용 액션 추가.
  - `resolveLinkerStructure`, `resolvePayloadStructure`: 외부 API를 통한 구조 재조회.
  - `updateEntityStructure`: 구조 정보 수동 업데이트 및 최종 승인.

### 1.3 어드민 UI 구현
- **검수 큐 (Review Queue)**: `/admin/review` 페이지 신규 구축.
  - 링커/페이로드 목록 조회, 필터링, 검색 기능.
  - 상세 뷰: 구조 정보, 동의어, 신뢰도 점수 표시.
  - 액션: "구조 재조회" 및 "최종 승인" 기능 통합.
- **사이드바 업데이트**: `AdminSidebar.tsx`에 '검수 큐' 메뉴 추가.
- **i18n**: `ko.json`, `en.json` 번역 키 추가 및 구조 오류 수정 완료.
- **어드민 UI 개선**:
  - `AdminSidebar.tsx`: 상단 중복 로고 제거.
  - `ConnectorsPage`: "기본 커넥터 가져오기" 버튼 추가 및 백엔드 연동.
  - 데이터 연동: 프론트엔드 액션(`admin.ts`)이 백엔드 API(`connectors.py`)를 직접 호출하도록 개편.
  - 통계 데이터: `connector_runs` 대신 `ingestion_logs` 테이블을 참조하도록 수정하여 데이터 정합성 확보.

---

## 2. 문서(`docs/`) 내 누락 및 업데이트 필요 사항

현재 `docs/` 폴더 내의 기존 문서들은 최신 변경 사항을 반영하지 못하고 있습니다. 내일 다음 항목들에 대한 업데이트가 필요합니다.

### 2.1 `docs/db.md` (업데이트 필요)
- [ ] `entity_linkers`, `entity_drugs` 테이블의 확장된 컬럼 정의 추가.
- [ ] `evidence_snippets`, `entity_evidence_map` 테이블 명세 추가.
- [ ] 마이그레이션 이력에 `20260111154000_linker_payload_v2_schema.sql` 추가.

### 2.2 `docs/cheminformatics.md` (업데이트 필요)
- [ ] `resolver.ts`를 통한 하이브리드 SMILES 확보 전략(PubChem + OPSIN) 섹션 추가.
- [ ] 신뢰도 점수(Confidence Score) 계산 알고리즘 설명 추가.

### 2.3 `docs/evidence.md` (업데이트 필요)
- [ ] 엔티티 레벨 근거(Entity-level Evidence) 시스템 아키텍처 추가.
- [ ] RAG 파이프라인과 `evidence_snippets` 테이블의 연동 방식 설명.

### 2.4 `docs/ui-design-spec.md` (업데이트 필요)
- [ ] 관리자 섹션에 `3.6 검수 큐 (/admin/review)` 페이지 명세 추가.

### 2.5 `docs/migrations.md` (업데이트 필요)
- [ ] 실행 순서에 최신 마이그레이션 파일 추가.

---

## 3. 내일 작업 계획 (Next Steps)

1. **RAG 파이프라인 통합**:
   - Python 워커에서 추출된 링커/페이로드 후보와 근거 데이터를 `evidence_snippets` 테이블에 자동으로 적재하는 로직 구현.
2. **리포트 생성 엔진 고도화**:
   - 설계 리포트 출력 시 `entity_evidence_map`을 참조하여 해당 링커/페이로드의 근거 문헌을 자동으로 인용(Citation)하는 기능 추가.
3. **검수 UI 개선**:
   - 검수 큐 상세 페이지에서 관련 근거 스니펫(Evidence Snippets)을 직접 확인하고 편집할 수 있는 기능 추가.
4. **테스트 및 검증**:
   - 전체 워크플로우(수집 -> 조회 -> 검수 -> 리포트 인용)에 대한 엔드투엔드 테스트 진행.

---

## 4. 특이 사항 및 주의 사항
- **빌드 오류 해결**: `ko.json`의 JSON 문법 오류와 `admin/seeds/page.tsx`의 TypeScript 타입 오류를 모두 수정하여 현재 Vercel 배포가 정상적으로 가능합니다.
- **API 제한**: PubChem/OPSIN API 호출 시 Throttling에 주의해야 하며, 현재 `resolver.ts`에 기본적인 지연 로직이 포함되어 있습니다.
