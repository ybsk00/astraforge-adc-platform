# ADC 도메인 자동화(Seed-Driven) 사용자/어드민 UI 설계서 (상세)

## 0. 목적
현재 시스템은 Open Targets / UniProt / PubMed / ChEMBL / PubChem / ClinicalTrials / HPA / openFDA 등 다수 소스를 Seed Set(암종/표적/약물 목록)과 연결해 **사용자 입력 없이도 자동 쿼리 생성 → 수집 → 정규화 → 근거화 → 리포트**까지 수행하도록 설계되어 있습니다.  
그러나 “어디서 무엇을 가져오는지”와 “무엇을 눌러야 동작하는지”가 UI에 드러나지 않아 사용/운영이 어렵습니다.

본 문서는:
- **사용자 UI**: 최소 입력으로 Run(수집/분석 실행)을 만들고, 결과를 이해/활용 가능
- **어드민 UI**: Seed/커넥터/잡/품질을 운영·통제 가능
을 목표로 **화면 구조 + 모든 입력 필드 + 작동 프로세스(단계/상태/예외)**를 정의합니다.

---

## 1. 핵심 개념(UX에 반드시 노출)
### 1.1 Seed Set(Seed Library)
- 의미: “암종/표적/약물/항체/링커/페이로드 등”의 표준 목록(골든 데이터)
- 역할: 사용자가 검색어를 만들지 않아도, 시스템이 Seed를 기반으로 소스별 최적 쿼리를 자동 생성

### 1.2 Connector(데이터 소스 커넥터)
- 의미: Open Targets, PubMed 등 외부 소스별 수집기/정규화기
- 역할: Seed를 받아 소스별로 “찾고 → 가져오고 → 정리하고 → 근거 링크를 남김”

### 1.3 Run(실행)
- 의미: Seed Set + 선택한 목적/필터/커넥터 조합으로 생성되는 “작업 단위”
- 결과: 정규화된 엔티티 테이블 + 근거 문장/링크 + 요약 리포트

---

## 2. 권한/역할 모델
- **User(일반 사용자)**: Seed 선택/실행/결과 조회/내보내기
- **Admin(운영자)**: Seed 등록/편집, 커넥터 상태 관리, 잡 모니터링/재시도, 품질 규칙 관리, 사용자/워크스페이스 관리

---

## 3. 네비게이션(IA)
### 3.1 사용자 UI 메뉴
1) 대시보드  
2) Seed 라이브러리(읽기 중심)  
3) 새 실행(Seed 기반)  
4) 실행 내역(Runs)  
5) 결과 탐색(Results Explorer)  
6) 리포트(Reports)  
7) 설정(프로필/내보내기/알림)

### 3.2 어드민 UI 메뉴
1) Overview(운영 요약)  
2) Seed 관리(Seed Library Admin)  
3) Connectors 관리  
4) Runs/Jobs 관리(큐/워커/재시도)  
5) 품질(QA) 규칙/정규화 룰  
6) 사용자/워크스페이스 관리  
7) 감사로그(Audit Log)  
8) 시스템 설정(API Key, Rate Limit, 스케줄)

---

## 4. 사용자 UI 상세 설계

## 4.1 사용자 대시보드 (/app)
### 목적
“지금 무엇이 가능한가”를 한 화면에서 이해시키고, **3클릭 이내 실행 시작**.

### 구성
- 상단 KPI 카드
  - 최근 실행 수(7일)
  - 마지막 실행 상태(성공/실패/진행중)
  - 최신 리포트 바로가기
- 빠른 실행 버튼: **[새 실행 만들기]**
- 최근 실행 리스트(최근 10개)
  - 컬럼: Run 이름 / 암종 / Seed 개수 / 선택 커넥터 / 상태 / 시작일 / 종료일 / 상세

### 입력 필드
- 없음(대시보드)

### 작동 프로세스
- “새 실행 만들기” → 4.3 새 실행 Wizard로 이동
- “최근 실행 클릭” → 4.4 실행 상세로 이동

---

## 4.2 Seed 라이브러리(읽기) (/app/seeds)
### 목적
사용자가 Seed를 “찾고 선택 가능한 형태”로 이해

### 화면 요소
- 검색/필터 바
  - 검색: 암종명, 표적명, 약물명, 동의어
  - 필터: Seed 타입(암종/표적/약물/항체/링커/페이로드), 태그, 업데이트 날짜
- Seed 목록 테이블
  - 컬럼(예): Seed Name / Type / Canonical ID / Synonyms / Source / Updated At
- Seed 상세 패널(우측 드로어)
  - Canonical ID (예: UniProt ID 등)
  - 동의어 목록
  - 기본 추천 커넥터(예: 표적이면 UniProt/HPA/OpenTargets 우선)
  - “이 Seed로 실행 만들기” CTA 버튼

### 입력 필드(필터)
- keyword (text)
- seed_type (single select)
- tags (multi select)
- updated_after (date)

### 작동 프로세스
- Seed 상세에서 CTA → 새 실행 Wizard로 이동(Seed가 미리 선택된 상태)

---

## 4.3 새 실행 Wizard (/app/runs/new)
### 목표
사용자 입장에서 “무엇을 넣어야 하는지”가 명확해야 하며, 기본값으로 대부분 동작해야 합니다.

### Step 1) 목적 선택
**필드**
- Run 이름 (text, default: “{암종}-{날짜} 자동수집”)
- 실행 목적 (single select)
  - A. 표적 우선순위 선정(Target Prioritization)
  - B. 페이로드/약물 후보 분석(Payload/Drug Landscape)
  - C. 임상/경쟁 현황(Clinical & Competitive)
  - D. 안전성/독성 리스크(Safety & Toxicity)
  - E. 전체 통합(Full Pipeline, 느리지만 포괄)

**동작**
- 목적에 따라 추천 커넥터/필터 기본값 자동 세팅

---

### Step 2) Seed 선택
**필드**
- 암종 선택 (single select, 필수)
  - Seed Library의 Cancer Seed
- 표적 Seed 선택 (multi select, 선택)
- 약물/페이로드 Seed 선택 (multi select, 선택)
- “추천 Seed 자동 추가” (toggle, default ON)
  - ON일 경우: 암종 기반으로 상위 표적/약물 Seed를 자동 추천 목록에 추가

**UX**
- 좌측: Seed 검색 결과
- 우측: 선택된 Seed 바구니 + 개수 표시

---

### Step 3) 데이터 소스(Connector) 선택
**기본 원칙**
- 사용자는 “소스 이름”을 몰라도 실행 가능해야 함  
- 대신 각 소스가 **무슨 정보를 가져오는지** UI에 명확히 표시

**커넥터 카드(각 소스 1장 카드)**
- Open Targets: 질환-표적 연관성/유전근거
- UniProt: 단백질 기능/서열/도메인
- PubMed: 논문 초록/근거
- ChEMBL: 화합물 활성/약물 타겟
- PubChem: 화학 구조/물성/표준화
- ClinicalTrials: 임상 단계/NCT/결과
- HPA: 조직별 발현/선택성
- openFDA: 승인/부작용/안전성

**필드**
- 포함할 소스 (multi select; 목적 기반 추천값 preselect)
- 수집 깊이(Depth) (single select)
  - Lite(빠름) / Standard(기본) / Deep(느림, 포괄)
- 기간 필터(time range) (single select)
  - 최근 1년 / 3년 / 5년 / 전체
- 최대 수집량(max results) (number, default: Standard에 맞춤)

---

### Step 4) 실행 옵션(품질/중복/랭킹)
**필드**
- 중복 제거(dedup) (toggle, default ON)
  - 기준: Canonical ID + 주요 키
- 신뢰도 랭킹 가중치(weight presets) (single select)
  - “근거 중심” / “임상 중심” / “안전성 중심” / “균형”
- 오류 시 재시도(retry) (toggle, default ON)
- 실행 모드(mode) (single select)
  - 지금 실행(Run Now)
  - 예약 실행(Schedule) — (MVP에서는 숨김 가능)

**버튼**
- [쿼리 미리보기]  
  - Seed + 소스 기반으로 생성된 “예상 쿼리”를 사용자에게 보여줌(투명성)
- [실행 시작]

---

## 4.4 실행 상세 (/app/runs/{run_id})
### 목적
“지금 무엇이 진행 중인지”와 “왜 실패했는지”를 한눈에 파악

### 섹션 A: Run 요약
- Run 이름 / 생성일 / Seed 요약(암종/표적/약물 개수) / 선택 소스 / 모드 / 상태

### 섹션 B: 진행 상황(Progress)
- 단계별 상태 타임라인
  1) Query Build (쿼리 생성)
  2) Fetch (수집)
  3) Normalize (정규화/ID 매핑)
  4) Evidence (근거 문장/링크 추출)
  5) Index (RAG 인덱싱)
  6) Report (요약/리포트 생성)

각 단계 표시:
- 상태: Pending / Running / Success / Failed
- 처리량: 예) “PubMed 120/200”
- 마지막 업데이트 시간

### 섹션 C: 결과 미리보기(핵심 테이블)
- Target candidates Top 20
- Payload/Drug candidates Top 20
- Clinical landscape Top 20
- Safety signals Top 20

### 섹션 D: 에러/경고 로그(사용자 친화)
- “무엇을 시도했는지”
- “왜 막혔는지(예: rate limit, empty result, id mismatch)”
- “해결 팁(필터 완화/소스 변경)”

### 액션
- [재실행] (같은 설정으로)
- [설정 복제] (New Run에 프리필)
- [내보내기] CSV/JSON/PDF(리포트)

---

## 4.5 결과 탐색(Results Explorer) (/app/results)
### 목적
사용자가 “데이터를 검색/필터/근거 확인”할 수 있게 제공

### 탭 구조
- 탭1: Targets
- 탭2: Drugs/Payloads
- 탭3: Trials
- 탭4: Safety
- 탭5: Evidence(근거 문장/링크)

### 공통 필드
- Run 선택 (single select)
- 검색 (text)
- 필터(멀티)
  - 소스(Connector)
  - 스코어 구간
  - 근거 수(문헌/임상/부작용)
  - 조직 발현(있을 경우)

### 핵심 UX: “근거 패널(Evidence Drawer)”
- 항목 클릭 → 우측 패널에
  - 근거 문장(짧게)
  - 출처 링크(논문/DB)
  - 정규화된 ID(UniProt, PubChem CID 등)
  - “왜 추천되는지” 요약(점수 산식 기반)

---

## 4.6 리포트 (/app/reports/{run_id})
### 목적
의사결정 가능한 형태로 요약

### 섹션
- Executive Summary (1페이지)
- Top Targets + 근거
- Top Payload/Drugs + 근거
- Clinical Landscape(경쟁/단계)
- Safety/Toxicity Signals
- Appendix: 쿼리/소스/정규화 규칙

### 버튼
- PDF Export
- 공유 링크(권한 기반, 선택)

---

# 5. 어드민 UI 상세 설계

## 5.1 Admin Overview (/admin)
### 목적
운영지표 + 장애 감지

### 카드
- 오늘 실행 수 / 실패율 / 평균 실행시간
- 커넥터 상태(Up/Degraded/Down)
- 워커 큐 적체량
- 최근 실패 Top 5 (원인 분류 포함)

---

## 5.2 Seed 관리 (/admin/seeds)
### 목표
Seed의 품질이 자동화 품질을 좌우하므로 “편집/버전/검증”이 필요

### 리스트 컬럼
- Seed Name / Type / Canonical ID / Synonyms count / Status(active/deprecated) / Updated / Owner

### Seed 생성/편집 폼 (모달 또는 상세 페이지)
**필수 입력**
- Seed Name (text)
- Seed Type (select: cancer/target/drug/antibody/linker/payload/other)
- Canonical ID (text)
- Canonical Source (select: UniProt/PubChem/ChEMBL/Manual/Other)
- Synonyms (textarea or tag input)
- Tags (multi select)

**선택 입력**
- Recommended Connectors (multi select)
- Default Query Hints (json editor or key-value)
- Notes(운영 메모)

**검증 버튼**
- [ID 검증] (예: UniProt ID 형식 검증 등)
- [샘플 쿼리 테스트] (해당 Seed로 커넥터 1개를 Dry-run)

---

## 5.3 Connectors 관리 (/admin/connectors)
### 목적
소스별 상태/키/레이트리밋/스키마 매핑을 운영자가 제어

### 커넥터 상세 설정
**기본 정보**
- Connector Name
- Base URL / API Key 사용 여부
- 상태: Enabled/Disabled
- Rate Limit 정책
  - req/min, backoff 전략, retry 횟수

**정규화 설정**
- ID 매핑 룰(예: target_name → UniProt ID)
- 필드 매핑(소스 응답 → 내부 표준 스키마)

**헬스체크**
- [Ping 테스트]
- [샘플 실행] (Seed 1개로 10건만)

---

## 5.4 Runs/Jobs 관리 (/admin/jobs)
### 목적
“왜 멈췄는지 / 어디서 적체인지 / 재시도가 필요한지”를 즉시 처리

### 화면 구성
- Run 목록(필터: 상태/사용자/날짜/커넥터)
- Run 클릭 → 하단 Job 타임라인
- Job 테이블 컬럼
  - job_id / run_id / connector / step / status / attempts / started_at / duration / error_code

### 관리자 액션
- [재시도] (단일 job)
- [스킵] (특정 커넥터 단계만)
- [강제 실패 처리] (전체 run 마감)
- [로그 다운로드]

---

## 5.5 품질(QA) 규칙 (/admin/quality)
### 목적
자동 수집은 “쓰레기 유입 방지”가 핵심

### 규칙 예시(토글/파라미터)
- 빈 결과 허용 임계치(예: 3회 연속 empty면 경고)
- ID 매핑 실패율 임계치(예: 20% 이상이면 Run 경고)
- 근거 링크 필수 여부(특정 리포트에서)
- 소스별 신뢰도 스코어 기본값

---

## 5.6 사용자/워크스페이스 (/admin/users)
- 사용자 목록, 워크스페이스 할당
- 사용량(실행 수/데이터량)
- 권한(role) 변경
- 공유 링크 정책(외부 공유 on/off)

---

# 6. “불편함”을 해소하는 핵심 UX 원칙 7개
1) **새 실행 Wizard**는 4단계 고정(목적→Seed→소스→옵션)  
2) 모든 소스는 “무슨 정보를 주는지”를 카드에 한 줄로 명시  
3) Run 상세에 “단계별 진행률 + 처리량 + 실패 원인 + 해결 팁”을 표준화  
4) 결과 화면에서 “근거 패널(Evidence Drawer)”은 필수  
5) 쿼리 미리보기 제공(자동화의 투명성)  
6) 기본값만으로 Standard 실행이 되게(입력 최소화)  
7) Admin은 “재시도/스킵/헬스체크”가 1~2클릭으로 가능

---

# 7. 작동 프로세스(엔드투엔드) 정의

## 7.1 사용자 관점(정상 흐름)
1) 사용자가 암종 선택 + (선택)표적/약물 Seed 선택  
2) 목적 선택 → 시스템이 추천 커넥터 자동 선택  
3) 실행 시작  
4) 시스템이 자동으로:
   - Query Build: Seed 기반 소스별 쿼리 생성
   - Fetch: 소스 API 호출/크롤링
   - Normalize: Canonical ID 정규화(UniProt, PubChem CID 등)
   - Evidence: 근거 문장/링크 추출(PubMed 등)
   - Index: RAG 인덱싱
   - Report: 목적에 맞는 요약 리포트 생성
5) 사용자는 Run 상세/Results/Report에서 확인 및 내보내기

## 7.2 실패/예외 처리 표준(사용자 UI에 노출)
- Rate limit → 자동 백오프 + 남은 예상 시간 표기
- Empty result → “필터 완화(기간/Depth)” 안내 + 추천 버튼
- ID mismatch → “동의어 추가/Seed 보정” 안내 + Seed 수정 요청 링크
- Connector down → 해당 커넥터 스킵 가능(사용자 선택 or 자동)

---

# 8. 화면별 입력 필드 요약(체크리스트)

## 사용자
- Run 생성: run_name, objective, cancer_seed, target_seeds[], drug_seeds[], connectors[], depth, time_range, max_results, dedup, weight_preset, retry, schedule(optional)
- 결과 탐색: run_id, query, filters(source, score, evidence_count, expression), sort
- 리포트: export_format, share_policy(optional)

## 어드민
- Seed: name, type, canonical_id, canonical_source, synonyms[], tags[], status, recommended_connectors[], query_hints, notes
- Connector: enabled, api_key_ref, rate_limit, retry_policy, mapping_rules, healthcheck
- Jobs: retry/skip/fail actions + 로그
- QA: thresholds, scoring defaults, required evidence rules
- Users: role, workspace_id, quotas, share_policy

---

# 9. (권장) MVP 범위 제안
- 사용자: 새 실행 Wizard + Run 상세(진행률/로그) + Results Explorer(근거 패널) + PDF 리포트
- 어드민: Seed 관리 + Connector 상태/헬스체크 + Jobs 재시도/스킵 + QA 임계치 최소 세트

---
