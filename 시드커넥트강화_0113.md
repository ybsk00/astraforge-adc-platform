현재 Seed 커넥터(seed_fetch_job) 코드 기준으로의 진단과, 지금 상태에서 바로 고쳐야 “Golden Seed 품질(표적 다양성/중복 감소/추출 성공률)”이 올라가는 수정안을 묶은 MD입니다.
(요청하신 대로 “시드 커넥트도 봐달라”는 관점에서, 지금 코드가 왜 189/4/6/4로 나오고, 어디가 병목인지, Golden Seed와 어떻게 연결해야 하는지까지 포함합니다.)

Seed 커넥터(Seed Connector) 진단 및 수정 권장안 v1
1) 현재 Seed 커넥터 결과 해석

Result Summary

{
  "stats": {
    "linkers": 4,
    "targets": 189,
    "payloads": 6,
    "antibodies": 4
  },
  "status": "completed"
}

의미

targets 189: GOLD_TARGETS(8개) + targets_seed_200.json에서 추가 로드된 타겟들이 component_catalog(type='target')에 적재됨.

antibodies 4 / payloads 6 / linkers 4: 하드코딩된 GOLD_* 리스트만 들어간 상태.

한 줄 결론

타겟 시딩은 “확장(189개)”이 어느 정도 성공,

하지만 **항체/링커/페이로드 시딩은 “초기 골드만”**이라서, Golden Seed에서 구성요소(4요소) 매핑/표준화에 활용하기에는 아직 매우 얇습니다.

2) Seed 커넥터 코드의 핵심 문제점 (Golden Seed 품질에 직접 영향)
문제 A — 타겟 Merge 로직이 “파일 우선”이 아니라 “GOLD_TARGETS 우선”

현재 로직:

existing_symbols = {t["gene_symbol"] for t in targets}
if ft["gene_symbol"] not in existing_symbols:
    targets.append(ft)
else:
    pass  # 이미 존재하면 넘어감 (기존 GOLD_TARGETS 우선)

문제

파일(targets_seed_200.json) 쪽이 더 풍부한 필드를 가지고 있어도 기존 GOLD_TARGETS 레코드가 있으면 파일 데이터를 버립니다.

결과적으로 HER2/HER3 같은 핵심 타겟에서 동의어/추가 메타가 있더라도 반영이 안 될 수 있습니다.

권장 수정(필수)

“파일 데이터 우선”으로 병합하거나, 충돌 시 필드별 merge 하세요.

문제 B — Upsert 기준이 분산되어 있어 중복/불일치가 생길 수 있음

현재:

gene_symbol 있으면 gene_symbol로 조회/업데이트

없으면 name으로 조회/업데이트

문제

파일 타겟 중 gene_symbol 누락 또는 name이 표준명과 다르게 들어오면 같은 타겟이 중복 삽입될 수 있습니다.

Golden Seed의 표적 매핑이 “name 문자열 비교” 중심이면 매칭 실패/Unknown 증가로 이어집니다.

권장 수정(필수)

component_catalog에 type + gene_symbol unique(가능하면 workspace_id null 조건 포함) 를 강제하고,

gene_symbol이 없는 경우는 seed 단계에서 가능하면 Ensembl/UniProt 기반으로 채워 넣도록(최소한 gene_symbol 없는 레코드는 quality_grade를 낮추고 Golden Seed 매핑에서 제외)

문제 C — 항체/링커/페이로드가 너무 얇아 Golden Seed “표준화 사전”으로 못 씀

현재:

항체 4개, 링커 4개, payload 6개

영향

Golden Seed는 지금 golden_seed_job.py에서

payload/linker는 suffix 휴리스틱 + dictionary 매칭

target/antibody는 문자열 휴리스틱

인데, 이게 DB 기반으로 표준화되려면 component_catalog에

항체 최소 수십 개(approved+late-stage ADC 항체 이름/동의어 포함)

payload 최소 수십 개(MMAE/MMAF/DM1/DM4/DXd/SN-38/PBD/exatecan 계열 등)

linker 최소 수십 개(VC/Val-Cit 계열, GGFG, SMCC, SPDB 등 + 동의어)
가 필요합니다.

3) Seed 커넥터 수정 목표 (Golden Seed와 “실제로” 연결되게)
목표

component_catalog를 Golden Seed의 표준화/매핑 기준 테이블로 사용 가능하게 만든다.

Golden Seed에서 Unknown을 줄인다(특히 target/antibody/payload/linker).

타겟 다양성을 확보한다(HER2/HER3 포함 핵심 표적들이 실제로 “매칭”되게).

4) 권장 수정안 (바로 적용 가능한 형태)
4.1 Merge 로직 변경: “파일 우선 + 필드 머지”

동일 gene_symbol이면:

name은 파일 값이 더 표준이면 교체

uniprot_accession/ensembl_gene_id 등 비어있는 필드만 채움

quality_grade는 gold > silver > bronze 우선순위로 결정

의사코드
by_symbol = {t["gene_symbol"]: t for t in GOLD_TARGETS if t.get("gene_symbol")}

for ft in file_targets:
    sym = ft.get("gene_symbol")
    if not sym:
        continue
    if sym not in by_symbol:
        by_symbol[sym] = ft
    else:
        # merge
        base = by_symbol[sym]
        for k in ["name","uniprot_accession","ensembl_gene_id"]:
            if ft.get(k) and (not base.get(k) or k == "name"):
                base[k] = ft[k]
        base["quality_grade"] = choose_grade(base, ft)
targets = list(by_symbol.values())

4.2 component_catalog에 “표준 키”를 강제하는 인덱스/제약 추가 (권장)

type=target은 gene_symbol이 표준 키

type=payload/linker/antibody는 name(표준명) + workspace_id(null) 기준

SQL (예시)
-- target은 gene_symbol을 표준키로 강제(가능하면 null 제외)
create unique index if not exists ux_component_target_symbol_global
on component_catalog(type, gene_symbol)
where workspace_id is null and type='target' and gene_symbol is not null;

create unique index if not exists ux_component_name_global
on component_catalog(type, name)
where workspace_id is null and name is not null;

4.3 항체/링커/페이로드 확장 시딩(최소 30~50개 단위로)

지금 4/4/6이면 Golden Seed에서 “DB 매칭”을 붙이기가 어렵습니다.

최소 확장 방향:

payload: MMAE/MMAF/DM1/DM4/DXd/SN-38/PBD/exatecan/duocarmycin 등

linker: Val-Cit(VC), GGFG, SMCC, SPDB 외에 동의어/파생

antibody: Trastuzumab 외에 HER2/HER3/TROP2/EGFR/CD19/CD22 관련 항체명/프로그램명 수준이라도 등록

운영 전략

처음부터 완벽한 “화학 구조”까지 넣지 말고,

우선 name + synonyms(properties.synonyms) 중심으로 확장

PubChem/ChEMBL 연동은 다음 단계

5) Golden Seed와 Seed 커넥터의 “연동 지점” (가장 중요)

Seed 커넥터가 component_catalog를 채우면, Golden Seed는 아래 방식으로 바뀌어야 합니다.

5.1 Golden Seed의 Extract 단계에서 “DB 기반 매칭”을 1차로

현재 Golden Seed는 suffix/문자열 휴리스틱 위주입니다.
이를 다음 순서로 변경하세요.

ClinicalTrials에서 가져온 drug_name/title/conditions를 텍스트 풀로 구성

component_catalog에서:

target: gene_symbol/name/synonyms 매칭

payload/linker: name/synonyms/suffix 매칭

antibody: name/synonyms 매칭

매칭 실패 시에만 suffix 휴리스틱 fallback

5.2 HER3가 안 나오는 이유(사용자 지적)와 Seed 관점 해결

HER3는 gene_symbol=ERBB3 입니다.

targets_seed_200.json에 ERBB3가 없거나, name이 “HER-3/ERBB3”로 들어가 있는데 현재 merge/insert 기준이 흔들리면

catalog에 있어도 Golden Seed가 문자열 매칭에서 못 잡습니다.

해결

component_catalog target에 synonyms 필드(properties.synonyms)로 ["HER3","HER-3","ERBB3"] 같이 넣고

Golden Seed 매칭은 synonyms까지 검색

6) Seed 커넥터의 “검증 쿼리”(즉시 확인)
6.1 타겟 수/품질 분포
select quality_grade, count(*)
from component_catalog
where workspace_id is null and type='target'
group by quality_grade
order by count(*) desc;

6.2 HER2/HER3 존재 확인
select id, name, gene_symbol, uniprot_accession, ensembl_gene_id, properties
from component_catalog
where workspace_id is null
  and type='target'
  and (gene_symbol in ('ERBB2','ERBB3') or lower(name) like '%her2%' or lower(name) like '%her3%');

6.3 gene_symbol 없는 타겟(정리 대상)
select count(*)
from component_catalog
where workspace_id is null and type='target' and gene_symbol is null;

7) 최종 권고(지금 당장 해야 할 것)

Seed 커넥터의 타겟 merge를 “파일 우선 + 필드 머지”로 수정

component_catalog에 target unique index(type, gene_symbol) 추가

payload/linker/antibody를 최소 30~50개로 확장(동의어 포함)

Golden Seed Extract를 “component_catalog 매칭 우선”으로 바꿔 Unknown을 크게 줄이기

그 다음에야 Golden Seed Top100 dedup/gate가 의미를 갖습니다(지금은 Extract가 무너져 Top100이 성립 안 함)