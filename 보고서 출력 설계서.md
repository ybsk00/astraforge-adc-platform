# ADC 적절성 평가 보고서 출력(Report) 설계서 — 과학적 근거/계산 근거/화학·공학 근거/이미지 포함

## 0. 목적
본 설계는 Seed-driven 파이프라인(Seed Set → 데이터 수집/정규화 → 근거화 → RDKit 계산 → 리포트) 결과를 바탕으로,
- **의사결정 가능한 수준의 보고서(PDF/HTML)**
- **모든 결론/평가 항목에 대한 과학적 근거(Evidence)**
- **RDKit 및 규칙 기반 계산 근거(입력/산식/트리거)**
- **화학적/공학적 적절성 평가(리스크·완화 전략 포함)**
- **이해를 돕는 설명용 이미지(세포 이미지/기전도/흐름도/히트맵 등)**  
를 자동 생성하도록 하는 **실제 적용 가능한 출력 구조**를 정의합니다.

---

## 1. 보고서 산출물 패키지(권장)
보고서 신뢰성과 재현성을 위해 “PDF 1장”이 아니라 패키지로 내보내는 것을 권장합니다.

### 1.1 산출물 목록
1) `Executive_Report.pdf`  
- 결론 중심(10~25p): 추천안, 리스크, 의사결정 포인트

2) `Scientific_Appendix.pdf` (또는 HTML)  
- 근거/계산 로그 포함(20~80p): Evidence ID, 링크, 점수 산식, 룰 트리거

3) `Computation_Log.json`  
- RDKit 원값, 스코어 계산 과정, SMARTS 알럿 매칭, 룰 버전, 입력 SMILES

4) `Data_Exports/`  
- `targets.csv`, `payloads.csv`, `trials.csv`, `safety.csv`, `pairs_bsAb.csv` 등

### 1.2 재현성 메타데이터(필수)
모든 보고서 상단 메타 박스에 아래를 포함합니다.
- `run_id`
- `generated_at`
- `data_snapshot_at` (수집 시점)
- `rule_set_version` (aggregation/bystander/toxicity alerts)
- `connector_versions` (가능하면)
- `model_version` (고도화 시 QSAR 모델)

---

## 2. Evidence(과학적 근거) 표기 규격
보고서의 모든 주장/평가/추천은 **Evidence ID**로 추적 가능해야 합니다.

### 2.1 Evidence ID 형식(권장)
- PubMed: `EVID-PUBMED-{pmid}-{nnn}`
- OpenTargets: `EVID-OT-{target_id}-{nnn}`
- UniProt: `EVID-UNIPROT-{uniprot_id}-{nnn}`
- HPA: `EVID-HPA-{gene}-{nnn}`
- ClinicalTrials: `EVID-CT-{nct}-{nnn}`
- openFDA: `EVID-FDA-{drug}-{nnn}`
- ChEMBL/PubChem: `EVID-CHEM-{chembl_or_cid}-{nnn}`

### 2.2 Evidence 레코드 최소 필드(DB/출력 공통)
- evidence_id
- source
- entity_type / entity_id
- url (또는 PMID/NCT)
- excerpt (짧은 요약 또는 25단어 이내 인용)
- extracted_at
- confidence_score(0~1 또는 0~100)
- claim_links[] (이 evidence가 뒷받침하는 “보고서 주장 ID” 목록)

---

## 3. 계산 근거(Computation) 표기 규격
RDKit 및 룰 기반 평가는 “점수”만 있으면 설득력이 없습니다. 아래 4가지를 반드시 출력합니다.

### 3.1 계산 근거 4요소(필수)
1) **입력(Input)**: SMILES / Canonical ID(PubChem CID, ChEMBL ID 등)  
2) **원값(Raw)**: RDKit descriptor 테이블  
3) **산식/룰(Formula/Rules)**: 가중치/임계치/룰 버전  
4) **트리거(Triggers)**: 어떤 조건이 걸렸는지(예: `cLogP>3.5 → +20`)

### 3.2 룰 버전(필수)
- `aggregation_rules_v1`
- `bystander_rules_v1`
- `tox_alerts_v1` (SMARTS rule set)
- `pains_rules_v1`

룰이 바뀌면 **재계산**을 통해 보고서가 달라질 수 있으므로, 보고서에 반드시 버전을 표기합니다.

---

## 4. 보고서 템플릿(목차 + 섹션별 출력 항목)

## 4.1 표지/요약 메타(1p)
- 보고서명: `{암종} ADC 적절성 평가 보고서`
- Run Meta:
  - Run ID:
  - 생성일:
  - Seed Scope: (암종/표적/약물/페이로드/링커 개수)
  - 포함 소스: OpenTargets, UniProt, PubMed, ChEMBL, PubChem, ClinicalTrials, HPA, openFDA
  - 룰/모델 버전

---

## 4.2 Executive Summary (1~2p)
### A) 추천 설계안 Top 3
각 설계안은 다음 형태로 고정합니다.
- **Design #1**: `Target — Antibody(Format) — Linker — Payload`
- 기대효과(1~2문장)
- 주요 리스크(1~2문장)
- 권고 액션(완화전략/추가 실험 3개 이내)

### B) 평가 스코어 대시보드(표)
| 축 | 점수(0~100) | High-risk 항목 | 근거 |
|---|---:|---|---|
| Biology 적절성 |  |  | Evidence IDs |
| Chemistry 적절성 |  |  | Computation IDs + Evidence IDs |
| Engineering 적절성 |  |  | Rules + Evidence IDs |
| Translational(임상/경쟁) |  |  | Evidence IDs |
| Safety/Toxicity |  |  | Alerts + Evidence IDs |

---

## 4.3 평가 프레임 및 기준(2~3p)
### A) Biology 적절성
- 표적의 선택성(정상조직 발현 위험)
- 내부화 가능성(근거 기반)
- 질환 연관성(OpenTargets)

### B) Chemistry 적절성(RDKit 기반)
- 응집성(aggregation risk)
- 독성 구조 경고(alerts)
- 바이스텐딩 proxy(확산/막투과 대리지표)

### C) Engineering 적절성(링커/접합/제조)
- 링커 타입(클리버블/논클리버블) 적합성
- 방출 메커니즘 적합성
- 공학적 실패 근거(룰 기반)

### D) Translational(임상/경쟁/현황)
- 임상 파이프라인/경쟁 약물(ClinicalTrials)
- 승인/부작용 신호(openFDA)

---

## 4.4 Target 섹션(타깃별 1~2p, 후보 Top N)
### 출력 항목(타깃 1개당)
1) **Canonical ID**: UniProt ID / Gene Symbol  
2) **Biology Summary** (UniProt 기반)  
3) **Subcellular Location / Membrane 여부** (ADC 적합성)  
4) **Expression Selectivity** (HPA 요약)
   - 위험 조직 Top 5
   - 정상조직 high expression 여부
5) **Disease Association** (OpenTargets)
6) **Evidence Highlights** (PubMed Top 3~10)
   - 문장 요약 + Evidence ID + 링크

#### 표(예시)
| 항목 | 결과 | 근거 |
|---|---|---|
| 막단백/표면 접근성 |  | EVID-UNIPROT-... |
| 정상조직 고발현 위험 |  | EVID-HPA-... |
| 질환 연관성 |  | EVID-OT-... |
| 내부화 근거 |  | EVID-PUBMED-... |

---

## 4.5 Payload 섹션(페이로드별 1~2p, 후보 Top N)
### A) 입력 및 정규화
- Payload Name / PubChem CID / ChEMBL ID
- SMILES
- Computation ID: `COMP-PAYLOAD-{payload_id}-{run_id}`

### B) RDKit 물성표(필수)
| Descriptor | Value |
|---|---:|
| MW |  |
| cLogP |  |
| TPSA |  |
| HBD/HBA |  |
| RotB |  |
| Rings/AromRings |  |
| Fsp3 |  |
| Formal Charge(가능 시) |  |

### C) 응집성(Aggregation Risk Score)
- 점수: `aggregation_score / 100`
- 트리거 목록(필수)
  - 예: `cLogP>3.5 (+20)`, `TPSA<40 (+15)` …
- 화학적 해설(LLM 생성; 반드시 계산 근거만 사용)
- 완화 전략(예: 링커 변경, payload 대체, 극성 조정 등)

### D) 독성(Structural Alerts)
- Reactive/Electrophile alerts: N개
- PAINS/Brenk alerts: N개
- 각 알럿:
  - rule_name, severity, 매칭 설명(짧게)
- 해설: “왜 리스크인지” + “실험 권고(예: stability/ADME/tox panel)”

### E) 바이스텐딩(Bystander Proxy Score)
- 점수: `bystander_proxy_score / 100`
- 트리거(필수)
  - 예: `TPSA<70 (+10)`, `charge!=0 (-15)` …
- 링크/방출 보정(선택)
  - cleavable이면 +10 등 (룰 버전 명시)

---

## 4.6 Linker / Conjugation / Engineering 섹션(2~6p)
### A) 링커 타입 적합성
- cleavable vs noncleavable의 선택 이유
- 방출 메커니즘(pH/효소/환원 등) 설명

### B) 공학적 실패 근거(룰 기반; 반드시 근거와 함께)
- 예: “payload 소수성↑ + 링커 소수성↑ → 전체 소수성↑ → 응집/제조 리스크↑”
- 예: “반응성 모티프 알럿 → 안정성/오프타깃 위험”
- 예: “분자량/극성 조합 → 확산 저하 → bystander 목표와 불일치”

### C) 권고 완화 전략(3~7개)
- 링커 교체(클리버블 방식 변경)
- payload 후보 교체
- DAR 목표 범위 조정(고도화 시)
- 안정성/혈장 절단 실험 권고 등

---

## 4.7 Multi-specific(다중항체) 적용 가능성 섹션(2~6p)
### A) 후보 Pair Top N
- Pair: Target A + Target B
- bsAb applicability score(0~100)
- 위험 조직 Top 3(HPA 기반)
- 내부화/표면성 근거(UniProt/PubMed)

#### 표(예시)
| Pair | Score | Safety Risk Organs | Internalization Evidence | 근거 |
|---|---:|---|---|---|
| A+B |  |  |  | Evidence IDs |

### B) 평가 논리(필수)
- Selectivity(암 vs 정상)
- Co-expression risk(정상 조직 동시 발현 가능성)
- Internalization 근거
- Safety overlap(치명 장기 발현)

### C) 결론/권고
- “적용 가능/보류/제외” + 근거
- 권고 검증 실험(예: 조직 패널, 내부화 어세이, 크로스리액티비티 등)

---

## 4.8 Translational(임상/경쟁/안전성) 섹션(2~6p)
### A) ClinicalTrials
- 경쟁 파이프라인 요약(단계/적응증)
- 주요 NCT 근거

### B) openFDA
- 승인 정보/부작용 신호(가능 범위)
- Safety 참고 근거

---

## 4.9 최종 추천 및 의사결정 체크리스트(1~2p)
- 추천안 1~3의 “Go/No-Go” 기준
- 추가 검증 실험 리스트(우선순위)
- 데이터 공백(Data Gaps) 명시

---

## 4.10 Scientific Appendix (상세 근거/계산 로그)
### A) Evidence 목록(소스별)
- Evidence ID, URL/PMID, excerpt, confidence, 연결된 주장 ID

### B) Computation Log 요약(페이로드별)
- SMILES
- RDKit raw
- aggregation/bystander 산식 및 트리거
- tox alerts 매칭 결과
- rule_version

---

## 5. “설명용 이미지” 구성(보고서 삽입 가이드)
본 섹션의 이미지는 **실험 결과를 가장하는 이미지가 아니라**, 이해를 돕기 위한 **설명용(Conceptual) 이미지**입니다.

### 5.1 필수 이미지 세트(권장)
1) ADC 작동 기전 도식(결합→내부화→절단→방출)
2) Bystander 효과 도식(표적세포 외 확산)
3) “세포 현미경 스타일” 설명용 이미지(합성)
   - Before/After 느낌(텍스트 없이)
4) 조직 발현 위험 요약(히트맵/바차트; 데이터 기반 시각화)
5) 파이프라인 개요(Seed → Connectors → Normalize → Calc → Report)

### 5.2 이미지 삽입 규칙
- 모든 그림에 캡션: “Conceptual illustration”
- 데이터 기반 차트는 run_id와 데이터 시점을 함께 표기

---

## 6. 이미지 생성 프롬프트(텍스트 없는 이미지용)
아래 프롬프트는 “보고서 이해를 돕는 설명용”이며, **텍스트는 넣지 않습니다**.

### 6.1 ADC 기전 도식(설명용)
- Prompt:
  - “Scientific schematic illustration of an antibody-drug conjugate mechanism: antibody binds a cancer cell surface receptor, internalization into endosome/lysosome, linker cleavage, payload release and cell death. Clean medical illustration style, high resolution, no text, white or neutral background, clear labeled-like visual elements but without any actual letters.”

### 6.2 Bystander 효과 도식(설명용)
- Prompt:
  - “Scientific schematic of bystander effect in ADC: one target-positive tumor cell internalizes ADC and releases payload that diffuses to neighboring target-negative tumor cells causing death. Minimalist medical illustration, high resolution, no text, show diffusion gradient with color shading only, no labels.”

### 6.3 세포 현미경 스타일(설명용, 합성)
- Prompt:
  - “Photorealistic microscopy-style image of cultured cells in a dish, before-and-after concept: left side healthy dense cells, right side showing reduced viability and morphological changes, fluorescence-like highlights, high detail, no text, looks like a generic lab microscopy image (not claiming real data).”

### 6.4 제조/응집 리스크 개념 이미지(설명용)
- Prompt:
  - “Photorealistic laboratory concept image: a vial containing slightly cloudy solution implying aggregation risk, lab bench background, soft lighting, no text, no brand markings, scientific tone.”

### 6.5 파이프라인 개요(설명용)
- Prompt:
  - “Clean infographic-style pipeline diagram illustration: seeds → multiple data sources → normalization → computation → report, using icons and arrows but absolutely no text characters, minimalist, high resolution.”

---

## 7. Report 생성 프로세스(시스템 동작 흐름)
### 7.1 트리거 위치(권장 UI)
- Run 상세 화면: `[Generate Report]`
- Reports & Artifacts 메뉴: 생성/버전 관리

### 7.2 Report 생성 단계(Worker Job)
1) Collect: run 결과 테이블 + evidence + computations 조회
2) Scoreboard: 축별 점수 집계(biology/chemistry/engineering/translational/safety)
3) Narrative: LLM로 해설 생성(근거/계산값만 인풋으로 제한)
4) Render: HTML → PDF 변환(또는 PDF 직접 생성)
5) Package: PDF + Appendix + JSON log + CSV export
6) Store: artifacts 테이블에 저장 + 다운로드 링크 제공

### 7.3 실패 처리
- evidence 부족: “Data gaps” 섹션에 자동 표기 + 경고
- SMILES 없음: payload 계산 스킵 + 원인 표기
- connector 다운: 해당 소스 근거 미포함 + run 메타에 기록

---

## 8. Artifacts(보고서) 저장 모델(권장)
- report_artifacts
  - id
  - run_id
  - artifact_type(executive/appendix/log/export_bundle)
  - file_path(or storage key)
  - generated_at
  - data_snapshot_at
  - rule_set_version
  - model_version
  - checksum(optional)
  - created_by

---

## 9. MVP 구현 체크리스트(보고서 중심)
### 필수
- Evidence ID 부여 + Appendix 출력
- RDKit raw + 스코어 산식 + 트리거 로그 출력
- Payload 카드(응집/독성알럿/바이스텐딩) 보고서 반영
- Multi-specific 섹션(룰 기반이라도) 포함
- 이미지(설명용) 3~5개 자동 삽입

### 선택(고도화)
- 독성 QSAR 확률 점수
- bystander/bsAb 레이블 축적 후 모델화
- 사용자 공유 링크/권한 제어

---
