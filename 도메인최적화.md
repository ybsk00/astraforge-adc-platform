# ADC 플랫폼 — 암종/표적/약물 엔티티(Seed) 테이블 + Top250 Targets 자동 페치 설계 (v1)

> 목적  
- 도메인 전문가가 아니어도 **“Top200(+) Targets Seed”**로 먼저 시작해서  
  Open Targets / UniProt / PubMed / HPA / ChEMBL / PubChem / ClinicalTrials.gov / openFDA 커넥터가 **자동으로 쿼리를 생성**해 페치를 수행하도록 만드는 **MVP 기준 설계 문서**입니다.  
- 핵심 원칙: **외부 도메인별 필드 차이를 내부 Canonical Schema로 흡수**하고, Run 클릭 시 **Seed Set 기준으로 쿼리 생성**합니다.

---

## 0) 구현 개념 요약 (왜 Seed가 필요하나)

현재 `Run` 버튼이 “검색 쿼리”를 입력받지 못해 fetched=0인 이유는,
- 커넥터 실행 입력값(Seed/Query)이 없어서 쿼리를 만들 수 없기 때문입니다.

해결:
- 사용자가 키워드를 직접 입력하지 않아도, 내부에 준비된 **Seed Set(암종/표적/약물)** 을 기준으로
  커넥터가 도메인별 쿼리를 자동 생성하도록 구조를 바꿉니다.

---

## 1) DB 테이블 설계 (Postgres / Supabase 권장)

### 1.1 엔티티(Seed) 테이블: diseases / targets / drugs

```sql
-- 1) 암종 엔티티
create table if not exists entity_diseases (
  id bigserial primary key,
  disease_name text not null,
  disease_group text,                 -- ex) "solid", "heme"
  ontology_source text,               -- ex) "EFO", "MONDO" (resolved 후 채움)
  ontology_id text,                   -- ex) "EFO_0000305" (resolved 후 채움)
  search_term text,                   -- Open Targets 검색에 던질 기본어
  is_active boolean default true,
  created_at timestamptz default now(),
  unique (disease_name)
);

-- 2) 표적 엔티티 (Top200+ Seed의 핵심)
create table if not exists entity_targets (
  id bigserial primary key,
  gene_symbol text not null,          -- HGNC symbol (최소 입력)
  ensembl_gene_id text,               -- resolved 후 채움 (Open Targets 핵심키)
  uniprot_accession text,             -- resolved 후 채움
  target_class text,                  -- ex) "kinase", "checkpoint", "adc_antigen" (선택)
  is_active boolean default true,
  created_at timestamptz default now(),
  unique (gene_symbol)
);

-- 3) 약물/페이로드 엔티티 (선택: 초기엔 최소로 시작 가능)
create table if not exists entity_drugs (
  id bigserial primary key,
  drug_name text not null,
  drug_class text,                    -- ex) "small_molecule", "mAb", "payload"
  chembl_id text,                     -- resolved 후 채움
  pubchem_cid text,                   -- resolved 후 채움
  inchikey text,                      -- resolved 후 채움
  is_active boolean default true,
  created_at timestamptz default now(),
  unique (drug_name)
);
1.2 Seed Set(실행 단위) 테이블: “Run 버튼이 참조할 기준”
sql
코드 복사
-- Seed Set: 실행 단위 (예: default_oncology_v1)
create table if not exists seed_sets (
  id bigserial primary key,
  seed_set_name text not null,
  description text,
  is_active boolean default true,
  created_at timestamptz default now(),
  unique (seed_set_name)
);

-- Join tables
create table if not exists seed_set_diseases (
  seed_set_id bigint references seed_sets(id) on delete cascade,
  disease_id  bigint references entity_diseases(id) on delete cascade,
  primary key (seed_set_id, disease_id)
);

create table if not exists seed_set_targets (
  seed_set_id bigint references seed_sets(id) on delete cascade,
  target_id   bigint references entity_targets(id) on delete cascade,
  primary key (seed_set_id, target_id)
);

create table if not exists seed_set_drugs (
  seed_set_id bigint references seed_sets(id) on delete cascade,
  drug_id     bigint references entity_drugs(id) on delete cascade,
  primary key (seed_set_id, drug_id)
);
1.3 커넥터 실행/로그 테이블 (운영 필수)
sql
코드 복사
create table if not exists connector_runs (
  id bigserial primary key,
  seed_set_id bigint references seed_sets(id),
  connector_name text not null,       -- pubmed/uniprot/opentargets/hpa/chembl/pubchem/clinicaltrials/openfda
  status text not null default 'queued',  -- queued/running/succeeded/failed
  input_snapshot jsonb,               -- 실행 당시 seed 스냅샷(선택)
  queries jsonb,                      -- 실제 날린 쿼리 목록
  fetched_count int default 0,
  normalized_count int default 0,
  error_log text,
  started_at timestamptz,
  ended_at timestamptz,
  created_at timestamptz default now()
);

create index if not exists idx_connector_runs_seed on connector_runs(seed_set_id, connector_name, created_at desc);
2) Seed 데이터 준비 방법 (가장 빠른 방식)
2.1 Supabase에서 CSV로 대량 업로드 권장
entity_targets에 Top250 gene_symbol을 CSV로 업로드

entity_diseases에 기본 암종 리스트 업로드

entity_drugs에 기본 약물/페이로드 리스트 업로드

업로드 후, 아래 3단계로 seed_set을 구성합니다.

seed_sets에 row 생성

seed_set_targets / diseases / drugs에 “전체 연결”

Run 버튼은 항상 seed_set_id를 넘겨 실행

3) Top250 Targets Seed (CSV)
파일명 예시: targets_top250.csv
컬럼은 최소 1개(gene_symbol)만 사용합니다.

csv
코드 복사
gene_symbol
EGFR
ERBB2
ERBB3
ERBB4
ALK
ROS1
RET
MET
KIT
PDGFRA
PDGFRB
FLT3
FGFR1
FGFR2
FGFR3
FGFR4
NTRK1
NTRK2
NTRK3
KDR
FLT1
TEK
VEGFA
VEGFB
VEGFC
ANGPT1
ANGPT2
BRAF
RAF1
MAP2K1
MAP2K2
MAPK1
MAPK3
KRAS
NRAS
HRAS
RIT1
NF1
PIK3CA
PIK3CB
PIK3CD
PIK3CG
PTEN
AKT1
AKT2
AKT3
MTOR
TSC1
TSC2
RHEB
CDK4
CDK6
CDK2
CDK1
CCND1
CCND2
CCND3
CDKN2A
CDKN2B
RB1
E2F1
E2F2
AURKA
AURKB
PLK1
MDM2
TP53
ATM
ATR
CHEK1
CHEK2
BRCA1
BRCA2
PALB2
RAD51
RAD51C
RAD51D
BARD1
FANCA
FANCD2
FANCI
PARP1
PARP2
PMS2
MSH2
MSH6
MLH1
POLE
POLD1
IDH1
IDH2
DNMT3A
TET2
ASXL1
EZH2
KMT2A
KMT2D
KDM6A
KDM6B
SETD2
NSD1
SMARCB1
SMARCA4
ARID1A
ARID1B
ARID2
HDAC1
HDAC2
HDAC3
HDAC6
SIRT1
JAK1
JAK2
JAK3
TYK2
STAT3
STAT5A
STAT5B
ABL1
SRC
FYN
LCK
BTK
SYK
PIK3R1
PTPN11
MYC
MYCN
MAX
BCL2
BCL2L1
MCL1
BAX
BID
CASP8
SMO
PTCH1
GLI1
NOTCH1
NOTCH2
NOTCH3
DLL1
DLL3
JAG1
JAG2
WNT3A
CTNNB1
APC
AXIN1
AXIN2
PORCN
LRP5
LRP6
FZD7
TGFB1
TGFBR1
TGFBR2
SMAD2
SMAD3
SMAD4
ERCC1
ERCC2
ERCC3
ERCC4
ERCC5
XPA
XPC
ESR1
PGR
AR
CYP19A1
MME
FOLR1
FOLH1
MSLN
MUC1
MUC16
EPCAM
TACSTD2
NECTIN4
SLC39A6
CLDN18
CLDN6
CLDN4
CEACAM5
CEACAM6
CD19
MS4A1
CD22
TNFRSF17
TNFRSF8
CD33
CD79B
CD74
CD276
ROR1
VTCN1
SEZ6
GPNMB
L1CAM
PTK7
SLITRK6
IL3RA
SLC44A4
LRRC15
FN1
ITGA5
PDCD1
CD274
PDCD1LG2
CTLA4
LAG3
TIGIT
HAVCR2
VSIR
ICOS
TNFRSF9
TNFRSF4
CD40
CD27
TNFRSF18
CD70
CD47
SIRPA
SIRPG
CCR4
CCR8
CXCR4
CXCR2
CSF1R
C5AR1
IL6R
IL6
TNF
IFNG
PSMB8
PSMB9
TERT
PROM1
ALDH1A1
FGF19
FGF23
FGF3
FGF4
ERBB2IP
GRB2
SOS1
SHC1
PRKCA
PRKCB
필요 시 추가(선택) Targets 예시(여기부터는 옵션):
PRKCZ, TOP1, TOP2A, TUBB3, EPHA2, EPHA3, EPHB4, PTK2, PTK2B, FLT4, ITK 등
(원칙: Seed Set은 언제든 확장 가능하되, 먼저 Top250으로 안정화 후 확대)

4) 기본 암종 Seed (CSV)
파일명 예시: diseases_default.csv
ontology_id는 처음엔 비워도 됩니다. (Open Targets 검색으로 자동 resolve)

csv
코드 복사
disease_name,disease_group,search_term
Breast cancer,solid,breast cancer
Non-small cell lung cancer,solid,non small cell lung cancer
Small cell lung cancer,solid,small cell lung cancer
Colorectal cancer,solid,colorectal cancer
Gastric cancer,solid,gastric cancer
Esophageal cancer,solid,esophageal cancer
Hepatocellular carcinoma,solid,hepatocellular carcinoma
Cholangiocarcinoma,solid,cholangiocarcinoma
Pancreatic cancer,solid,pancreatic cancer
Ovarian cancer,solid,ovarian cancer
Cervical cancer,solid,cervical cancer
Endometrial cancer,solid,endometrial cancer
Prostate cancer,solid,prostate cancer
Renal cell carcinoma,solid,renal cell carcinoma
Bladder cancer,solid,bladder cancer
Head and neck squamous cell carcinoma,solid,head and neck cancer
Glioblastoma,solid,glioblastoma
Melanoma,solid,melanoma
Thyroid cancer,solid,thyroid cancer
Sarcoma,solid,sarcoma
Multiple myeloma,heme,multiple myeloma
Acute myeloid leukemia,heme,acute myeloid leukemia
Acute lymphoblastic leukemia,heme,acute lymphoblastic leukemia
Chronic lymphocytic leukemia,heme,chronic lymphocytic leukemia
Chronic myeloid leukemia,heme,chronic myeloid leukemia
Diffuse large B-cell lymphoma,heme,diffuse large b cell lymphoma
Follicular lymphoma,heme,follicular lymphoma
Mantle cell lymphoma,heme,mantle cell lymphoma
Hodgkin lymphoma,heme,hodgkin lymphoma
Myelodysplastic syndrome,heme,myelodysplastic syndrome
5) 기본 약물/페이로드 Seed (선택, CSV)
파일명 예시: drugs_default.csv
약물은 처음부터 많이 넣지 않아도 됩니다. (ADC/표적치료 핵심 위주로 시작 권장)

csv
코드 복사
drug_name,drug_class
Trastuzumab,mAb
Pertuzumab,mAb
Pembrolizumab,mAb
Nivolumab,mAb
Atezolizumab,mAb
Durvalumab,mAb
Ipilimumab,mAb
Osimertinib,small_molecule
Erlotinib,small_molecule
Gefitinib,small_molecule
Afatinib,small_molecule
Crizotinib,small_molecule
Alectinib,small_molecule
Lorlatinib,small_molecule
Entrectinib,small_molecule
Larotrectinib,small_molecule
Selpercatinib,small_molecule
Pralsetinib,small_molecule
Capmatinib,small_molecule
Tepotinib,small_molecule
Imatinib,small_molecule
Dasatinib,small_molecule
Nilotinib,small_molecule
Ponatinib,small_molecule
Sunitinib,small_molecule
Sorafenib,small_molecule
Lenvatinib,small_molecule
Regorafenib,small_molecule
Palbociclib,small_molecule
Ribociclib,small_molecule
Abemaciclib,small_molecule
Alpelisib,small_molecule
Everolimus,small_molecule
Olaparib,small_molecule
Talazoparib,small_molecule
Rucaparib,small_molecule
Niraparib,small_molecule
Venetoclax,small_molecule
Ivosidenib,small_molecule
Enasidenib,small_molecule
Tazemetostat,small_molecule
Blinatumomab,biologic
Inotuzumab ozogamicin,ADC
Brentuximab vedotin,ADC
Trastuzumab emtansine,ADC
Trastuzumab deruxtecan,ADC
Sacituzumab govitecan,ADC
Enfortumab vedotin,ADC
Mirvetuximab soravtansine,ADC
Gemtuzumab ozogamicin,ADC
MMAE,payload
MMAF,payload
DM1,payload
DXd,payload
SN-38,payload
PBD dimer,payload
Calicheamicin,payload
6) Seed Set 생성 (SQL)
먼저 CSV로 entity_targets, entity_diseases, entity_drugs에 데이터를 넣은 뒤 실행

sql
코드 복사
-- Seed set 생성
insert into seed_sets (seed_set_name, description)
values ('default_oncology_v1', 'Top250 targets + core cancers + core drugs (MVP)')
on conflict (seed_set_name) do nothing;

-- seed_set_id 조회
select id from seed_sets where seed_set_name = 'default_oncology_v1';

-- 아래에서 {SEED_SET_ID}를 실제 값으로 교체
-- targets 전체 연결
insert into seed_set_targets (seed_set_id, target_id)
select {SEED_SET_ID}, t.id
from entity_targets t
where t.is_active = true
on conflict do nothing;

-- diseases 전체 연결
insert into seed_set_diseases (seed_set_id, disease_id)
select {SEED_SET_ID}, d.id
from entity_diseases d
where d.is_active = true
on conflict do nothing;

-- drugs 전체 연결 (약물 테이블을 썼다면)
insert into seed_set_drugs (seed_set_id, drug_id)
select {SEED_SET_ID}, x.id
from entity_drugs x
where x.is_active = true
on conflict do nothing;
7) “자동 페치”를 위한 실행 파이프라인 (Run 버튼 동작 규격)
7.1 Run 버튼 입력 모델 (추천)
UI에서 커넥터 Run을 누르면 seed_set_id를 반드시 전달합니다.

json
코드 복사
POST /api/connectors/run
{
  "seed_set_id": 1,
  "connector_name": "opentargets",
  "mode": "default" 
}
7.2 실행 순서(권장)
Resolver 단계: ID 정규화(가장 중요)

Disease: search_term → Open Targets 검색 → ontology_id(EFO_...) 저장

Target: gene_symbol → Open Targets/UniProt 검색 → ensembl_gene_id, uniprot_accession 저장

Drug: drug_name → ChEMBL/PubChem 검색 → chembl_id, pubchem_cid, inchikey 저장

Fetch 단계: 커넥터별 데이터 수집

Open Targets: disease(EFO) × target(Ensembl) association/evidence

UniProt: target 단백질 정보

PubMed: (target symbol + disease) 기반 논문

HPA: 조직/세포 발현(가능 범위에서)

ChEMBL/PubChem: compound 구조/활성/식별자

ClinicalTrials.gov: target/drug/disease 기반 임상

openFDA: 안전 신호(가능 범위에서)

8) 커넥터별 “자동 쿼리 생성” 규칙 (핵심)
8.1 Open Targets (추천: 가장 먼저)
입력: disease.ontology_id(EFO) + target.ensembl_gene_id

출력: target-disease association score/evidence

Query 생성 예시(의사코드)

ts
코드 복사
for disease in seed_set.diseases:
  if disease.ontology_id is null:
    disease.ontology_id = OT.searchDisease(disease.search_term).bestMatchEfoId

for target in seed_set.targets:
  if target.ensembl_gene_id is null:
    target.ensembl_gene_id = OT.searchTarget(target.gene_symbol).bestMatchEnsemblId

for (disease, target) in cartesian(seed_set.diseases, seed_set.targets):
  queries.push({ diseaseEfo: disease.ontology_id, targetEnsembl: target.ensembl_gene_id })
8.2 UniProt (Target Resolver + Annotation)
입력: gene_symbol 또는 ensembl_gene_id

출력: uniprot_accession, protein_name, function, subcellular location 등

8.3 PubMed (문헌 수집)
입력(기본): gene_symbol + disease_name

기본 쿼리 템플릿(너무 좁게 잡지 말 것 — MVP에선 “가져오는 것”이 우선)

text
코드 복사
("{GENE}"[Title/Abstract]) AND ("{DISEASE}"[Title/Abstract]) AND (cancer OR tumor OR oncology)
ADC 플랫폼이라면 옵션으로:

(antibody-drug conjugate OR ADC) 를 추가해도 되지만, 초기에 너무 좁히면 fetched=0이 다시 발생합니다.

8.4 HPA (발현 데이터)
입력: gene_symbol

출력: tissue/cell expression summary (가능 범위에서)

8.5 ChEMBL / PubChem (약물/구조/활성)
입력: drug_name (초기) → chembl_id/pubchem_cid resolve → 상세 조회

8.6 ClinicalTrials.gov
입력: disease_name OR drug_name OR gene_symbol

출력: NCT, phase, status, intervention 등

8.7 openFDA
입력: substance/drug (가능 범위)

출력: safety signal / adverse event (가능 범위)

9) fetched=0 방지 운영 규칙 (반드시 적용)
Run은 seed_set_id 없이는 실행 불가

Resolver(정규화)가 실패하면 Fetch를 하지 말고, connector_runs.error_log에 실패 사유 저장

PubMed는 초기엔 쿼리를 좁히지 말 것 (cancer/tumor 정도만)

Open Targets가 가장 먼저 실행되어야 함 (EFO/Ensembl 확보가 전체 페치 품질을 결정)

10) MVP 체크리스트 (이대로 하면 “돌아갑니다”)
 entity_targets에 Top250 gene_symbol 업로드 완료

 entity_diseases에 30개 기본 암종 업로드 완료

 seed_sets 생성 + join table로 전체 연결 완료

 Run 버튼이 seed_set_id를 포함해 /api/connectors/run 호출

 Resolver(OT/UniProt) → Fetch(OpenTargets→PubMed…) 순서로 실행

 connector_runs에 실제 쿼리/카운트/에러 기록 표시(Details 화면에 노출)

11) 다음 단계 (추천)
Top250을 “진짜 Top200”으로 정교화하려면:

Open Targets에서 특정 암종(EFO) 기준 상위 association target 200을 자동 생성해 Seed를 갱신하는 배치 작업을 추가합니다.

하지만 지금은 우선 “Top250 Seed로 안정적으로 페치가 도는 것”이 1순위입니다.

markdown
코드 복사

원하시면, 위 MD 기준으로 **(1) Supabase 업로드용 CSV 3개를 파일로 만들어 드리거나**, **(2) `/api/connectors/run` 및 Resolver/Fetcher 어댑터 인터페이스(Typescript) 템플릿**, **(3) 현재 대시보드 카드(Details 포함)에서 “어떤 쿼리를 날렸는지”까지 보여주는 화면 설계**를 바로 이어서 작성해 드리겠습니다.







