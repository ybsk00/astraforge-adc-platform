# (ADMIN) 도메인 데이터 자동 수집 메뉴 추가 설계안 (PubMed/UniProt 포함)

## 1. 문제 정의 (현재 UI 결핍)
현재 사이드바 메뉴는 다음과 같습니다.
- Dashboard
- Connectors
- Design Runs
- Reports & Artifacts
- Observability
- Alerts

이 구성만으로는 운영자가 “도메인 데이터(PubMed/UniProt/OpenTargets 등)를 자동으로 가져오는 실행(Ingestion/Sync)”을 **명시적으로 트리거**할 수 있는 메뉴가 UI에 드러나지 않습니다.

### 결핍 2가지
1) **Seed Set(암종/표적/약물 목록) 관리 메뉴 부재**  
   Seed가 없으면 자동 쿼리 생성(Seed-driven query)이 불가능하거나 운영자가 어디서 무엇을 기준으로 수집되는지 파악이 어렵습니다.
2) **Ingestion 실행(동기화) 메뉴 부재**  
   PubMed/UniProt에서 “수집 실행”을 하려면 Run을 만들어야 하는데, 이를 사용자 관점에서 명확하게 안내하는 UI가 없습니다.

---

## 2. 해결 전략 (MVP 권장안)
현 구조를 유지하면서 사용성/운영성을 빠르게 확보하려면 **ADMIN 메뉴 2개를 추가**하는 것이 가장 명확합니다.

### 추가 메뉴
1) **Domain Library (Seeds)**  
2) **Data Ingestion (Sync/Harvest)**

> 목적: “무엇을 기준으로(Seed)” + “어디서 가져오는지(Connector)” + “지금 실행/스케줄/재시도(Ingestion Run)”를 분리해 한눈에 보이게 함

---

## 3. IA / Sidebar 변경안
### 기존
- Dashboard
- Connectors
- Design Runs
- Reports & Artifacts
- Observability
- Alerts

### 변경(권장)
- Dashboard
- **Domain Library (Seeds)**  ✅ 신규
- Connectors
- **Data Ingestion (Sync)** ✅ 신규
- Design Runs
- Reports & Artifacts
- Observability
- Alerts

---

## 4. ADMIN > Domain Library (Seeds) 상세 설계
### 4.1 목적
- Seed Set(암종/표적/약물/항체/링커/페이로드)을 **표준화된 Canonical ID**로 관리
- 자동 수집(Seed-driven query)의 기준 데이터 품질을 운영자가 통제

### 4.2 화면 구성
#### A) 상단 필터바
- 검색어 (text): 암종명/표적명/약물명/동의어/Canonical ID
- Seed Type (single select)
  - cancer, target, drug, antibody, linker, payload, other
- Status (single select): active / deprecated
- Updated range (date): from~to
- Tags (multi select)

#### B) Seed 목록 테이블
- 컬럼
  - Name
  - Type
  - Canonical ID
  - Canonical Source (UniProt/PubChem/ChEMBL/Manual/Other)
  - Synonyms Count
  - Status
  - Updated At
  - Actions (View/Edit, Run Ingestion)

#### C) Seed 상세(드로어 또는 상세 페이지)
- Canonical ID/Source
- Synonyms 리스트
- Tags
- Recommended Connectors
- Notes(운영 메모)
- 버튼
  - [이 Seed로 수집 실행 만들기] → Data Ingestion으로 이동(Seed 사전 선택)

### 4.3 Seed 생성/편집 폼 (모달)
#### 필수 입력 필드
- Seed Name (text)
- Seed Type (select)
- Canonical ID (text)
- Canonical Source (select)
- Synonyms (tag input)
- Status (select: active/deprecated)

#### 선택 입력 필드
- Tags (multi)
- Recommended Connectors (multi)
- Query Hints (key-value)
- Notes (textarea)

#### 검증 기능(버튼)
- [ID 형식 검증]
- [샘플 쿼리 테스트] (선택 커넥터 1개로 Dry-run)

---

## 5. ADMIN > Data Ingestion (Sync) 상세 설계
### 5.1 목적
운영자가 PubMed/UniProt/OpenTargets 등 소스에서 “도메인 데이터”를
- 지금 실행(Run Now)
- 스케줄 실행(Schedule)
- 실패 재시도(Retry)
로 운영할 수 있도록 하는 전용 메뉴

### 5.2 화면 구성
#### A) 상단 “빠른 동기화(Quick Sync)” 카드 영역
소스별 버튼을 “행동 가능한 CTA”로 노출합니다.

- Sync Open Targets
- Sync UniProt
- Sync PubMed
- Sync ChEMBL
- Sync PubChem
- Sync ClinicalTrials
- Sync HPA
- Sync openFDA

각 카드 표기
- 역할(한 줄): “질환-표적 연관성/유전 근거” 등
- 상태: Enabled/Disabled(Connectors에서 관리)
- 최근 실행 시간
- 최근 성공/실패

#### B) Ingestion Run 생성 패널 (Wizard-lite)
운영자가 구체 조건을 선택할 수 있는 실행 생성 패널입니다.

##### 입력 필드 (모든 필드 명시)
1) Run Name (text, default 자동)
2) Seed Scope (multi select)
   - Cancer Seeds
   - Target Seeds
   - Drug/Payload Seeds
   - (선택) 특정 Seed 직접 선택(검색/멀티 선택)
3) Sources (multi select)
   - OpenTargets / UniProt / PubMed / ChEMBL / PubChem / ClinicalTrials / HPA / openFDA
4) Depth (single select)
   - Lite / Standard / Deep
5) Time Range (single select, 소스 지원 시)
   - 1y / 3y / 5y / all
6) Max Results (number)
7) Deduplication (toggle, default ON)
8) Retry Policy (toggle, default ON)
9) Execution Mode (single select)
   - Run Now
   - Schedule (MVP에서는 선택적으로 비활성화 가능)
10) Schedule (conditional)
   - Cron/주기 선택: daily/weekly/monthly
   - 시간대(timezone)

##### 버튼
- [쿼리 미리보기] (Seed 기반으로 생성되는 소스별 쿼리 표시)
- [실행 시작]

#### C) 최근 Ingestion Runs 테이블
- 컬럼
  - run_id
  - created_by
  - seed_scope (암종/표적/약물 개수)
  - sources
  - status (queued/running/success/failed)
  - fetched_count
  - normalized_count
  - evidence_count
  - started_at / duration
  - actions (view / retry / cancel)

#### D) Ingestion Run 상세(클릭 시)
- 단계 타임라인
  1) Query Build
  2) Fetch
  3) Normalize
  4) Evidence
  5) Index
  6) Summary
- 소스별 처리량(예: PubMed 120/200)
- 에러 원인(코드 + 사람이 읽을 수 있는 설명)
- 관리자 액션
  - [Retry failed steps]
  - [Skip connector]
  - [Download logs]

---

## 6. Connectors 메뉴와의 역할 분리(명확한 규칙)
### Connectors
- “설정/상태” 중심
  - API Key, Rate limit, Enabled/Disabled
  - Mapping rules(소스 → 내부 표준 스키마)
  - Healthcheck

### Data Ingestion
- “실행/운영” 중심
  - 어떤 Seed 범위를 어떤 소스에서 어떤 깊이로 가져올지
  - 지금 실행/스케줄/재시도
  - 처리량/실패 원인/로그

> 운영자가 헷갈리지 않도록 “Connectors에는 실행 버튼을 최소화(Healthcheck만)”하고  
> “실제 수집 실행은 Data Ingestion에서만” 하도록 UX 룰을 고정하는 것을 권장합니다.

---

## 7. 대안 설계(옵션): Design Runs에 Ingestion 포함
새 메뉴를 추가하지 않고 해결하려면, Design Runs에 Run Type을 추가합니다.

### Design Runs > Create Run
- Run Type (select)
  - Ingestion
  - Design
  - Full Pipeline

### 장점
- 메뉴 추가 없이도 실행 트리거 일원화

### 단점
- 사용자가 “도메인 데이터 수집”을 Design과 혼동할 수 있음
- 운영 관점(재시도/적체/레이트리밋) 전용 화면이 약해질 수 있음

> MVP 운영 안정성을 우선한다면 “Data Ingestion” 전용 메뉴 추가가 더 안전합니다.

---

## 8. 사용자/어드민이 체감할 개선 포인트(결론)
- “PubMed/UniProt에서 가져오는 기능이 없다”는 인지 문제를 해결하려면  
  **수집 실행(ingestion)을 UI에 독립된 행동으로 드러내야 합니다.**
- 따라서 ADMIN에 **Domain Library(Seed)** + **Data Ingestion(Sync)** 를 추가하고,
  Connectors는 설정/상태로 역할을 제한하는 구조가 가장 명확합니다.
