# 4대축(True Golden Set) 구축: LLM Drafting Assistant + Human Editor-in-Chief (보완 반영 최종 MD)

문서 목적  
- 골든셋 구축을 “사람이 조사/입력”에서 “LLM이 근거 기반 초안 작성”으로 전환하고,  
  사람은 “검수/승격(Verified)”만 수행하는 운영체계를 확정한다.  
- 4대축( Vedotin/MMAE, DXd, OptiDC, Independent ) 중심으로 True Golden Set을 구축하되,  
  **검색 노이즈 제거(Precision↑), 동의어/동일약물 매핑, Independent 축의 서브태깅 강제, One-Click Review UI**를 포함해
  실제 구현 가능한 수준으로 구체화한다.

---

## 0) 최종 정책(핵심 합의)

1) **LLM = Drafting Assistant (근거 기반 초안 작성)**  
2) **Human = Editor-in-Chief (검수/승격 책임자)**  
3) Golden Set은 **구조화 테이블(정답 데이터)**이며, 벡터DB(pgvector)는 **근거 문서 탐색(RAG)** 용이다.  
4) 모든 자동 채움 값은 기본 `Draft`이며, **Final 승격은 Gate Checklist 통과 + 사람 승인(Verified Lock)**이 필수다.  
5) 실패(Failed/Discontinued)는 Golden Set과 분리 저장하되, Golden UI에서 연결(참조) 가능하게 한다.

---

## 1) 왜 이 전략이 훌륭한가(총평 요약)

- **역할 정의가 명확**: LLM은 생성기가 아니라 “초안 작성 비서”, 사람은 입력자가 아니라 “편집장”  
- **추적성(Traceability)**: `field_provenance`로 “왜 이 값인가?”에 근거 문단까지 답변 가능  
- **4대축 멘탈 모델**: 복잡한 시장을 4대축으로 구조화해 사용자/운영 모두 효율적  
- **실패 학습 철학 구현**: 실패 데이터레이크를 분리하고, 설계 시 Negative 사례를 참조 가능

---

## 2) 아키텍처 역할 분리(Structured vs Vector)

### 2.1 Structured DB (정답/워크플로우)
- golden_seed_items: 골든셋 본체(약물/프로그램 단위)
- evidence_items: 근거 다건(1:N)
- field_provenance: 필드 값 ↔ 근거 연결(추적성 핵심)
- llm_jobs: LLM 작업 큐
- synonym_map: 동의어/동일약물 매핑(중복 생성 방지 핵심)

### 2.2 Vector DB (evidence_chunks)
- 논문/임상/특허/라벨/보도자료 텍스트 chunk + embedding + 메타데이터
- 목적: 후보 수집, 필드 채움 근거 검색, 실패 유사사례 탐색, 특허 감시

---

## 3) 검색 쿼리(Search Query) 최적화: 노이즈 제거(Precision↑)

### 3.1 공통 제외 키워드(강제 NOT)
> 시장보고서/투자분석/매출전망 노이즈 제거(토큰 낭비 방지)

- NOT (
  "global market size" OR "cagr" OR "market forecast" OR "investment analysis" OR
  "market report" OR "industry report" OR "market share" OR "valuation" OR "pipeline market"
)

### 3.2 공통 포함 키워드(ADC 구조 정보 집중)
- MUST: ("antibody-drug conjugate" OR ADC)
- SHOULD: (payload OR linker OR conjugation OR DAR OR "drug-to-antibody ratio" OR "cleavable" OR "non-cleavable")

### 3.3 출처 타입별 우선순위(수집/랭킹 정책)
1) ClinicalTrials / 라벨 / 공식 문서  
2) 원저 논문(전임상/임상)  
3) 특허(플랫폼 변형 탐지)  
4) 리뷰 논문(참고용)  
5) 시장 보고서/투자 분석(기본 제외)

---

## 4) 축(Axis)별 검색 쿼리 템플릿(보완 버전)

> 각 축은 (A) 넓게 수집(Recall), (B) 정밀 강화(Precision), (C) 후보명 추출(Drug list) 쿼리로 구성한다.  
> 모든 쿼리는 공통 NOT 조건(섹션 3.1)을 함께 적용한다.

### 4.1 Axis 1: Vedotin(MMAE)
(A) 넓게  
- ("vedotin" AND (ADC OR "antibody-drug conjugate")) NOT (…공통 NOT…)
- ("MMAE" AND (ADC OR "antibody-drug conjugate")) NOT (…공통 NOT…)
- ("monomethyl auristatin E" AND ADC) NOT (…공통 NOT…)

(B) 정밀 강화  
- (("vedotin" OR "MMAE") AND (linker OR "valine-citrulline" OR "vc-PAB") AND ADC) NOT (…공통 NOT…)

(C) 후보명 추출  
- ("vedotin" AND ("Phase" OR "NCT" OR "clinical trial") AND ADC) NOT (…공통 NOT…)

---

### 4.2 Axis 2: DXd(deruxtecan)
(A) 넓게  
- (("DXd" OR "deruxtecan") AND (ADC OR "antibody-drug conjugate")) NOT (…공통 NOT…)
- (("Enhertu" OR "trastuzumab deruxtecan") AND ADC) NOT (…공통 NOT…)

(B) 정밀 강화(특성/독성 포함)  
- (("DXd" OR "deruxtecan") AND ("bystander effect" OR ILD OR "interstitial lung disease") AND ADC) NOT (…공통 NOT…)

(C) 후보명 추출  
- (("DXd" OR "deruxtecan") AND ("Phase" OR "NCT") AND ADC) NOT (…공통 NOT…)

---

### 4.3 Axis 3: OptiDC(Kelun)
(A) 넓게  
- (("OptiDC" OR "Kelun") AND (ADC OR "antibody-drug conjugate")) NOT (…공통 NOT…)
- (("Kelun-Biotech" OR Kelun) AND "drug conjugate") NOT (…공통 NOT…)

(B) 정밀 강화  
- (("OptiDC" OR Kelun) AND (linker OR stability OR "site-specific" OR DAR) AND ADC) NOT (…공통 NOT…)

(C) 후보명 추출  
- (("OptiDC" OR Kelun) AND ("Phase" OR "NCT" OR "clinical trial") AND ADC) NOT (…공통 NOT…)

---

### 4.4 Axis 4: Independent (Trodelvy/Indy) — “쓰레기통 방지”
(A) 넓게(대표계열을 강하게 잡기)  
- (("Trodelvy" OR "sacituzumab govitecan") AND ADC) NOT (…공통 NOT…)
- (("SN-38" OR "govitecan") AND (ADC OR "antibody-drug conjugate")) NOT (…공통 NOT…)

(B) 정밀 강화  
- (("SN-38" OR "govitecan") AND (linker OR hydrolysable OR "cleavable") AND ADC) NOT (…공통 NOT…)

(C) 후보명 추출  
- (("Trodelvy" OR "sacituzumab govitecan" OR "SN-38") AND ("Phase" OR "NCT") AND ADC) NOT (…공통 NOT…)

---

## 5) 동의어 처리(Synonym Resolution) — 중복 생성 방지(필수)

### 5.1 문제
- 같은 약물이 문서마다 이름이 다르게 나타남  
  예: DS-8201 = Trastuzumab deruxtecan = Enhertu = T-DXd

### 5.2 해결: synonym_map 테이블 + “동일약물 판정” 단계 삽입
- Discovery(후보 생성) 전에 반드시 수행:
  1) 문서에서 추출된 drug mention(이름/코드명)을 확보
  2) synonym_map에서 기존 canonical과 매칭 시도
  3) 없으면 LLM에게 다음 질문으로 판정시키고 저장:
     - "이 문서의 약물이 기존 DB의 어떤 canonical drug과 동일한가? 근거는?"
  4) 동일하면 기존 레코드에 evidence를 추가, 신규 레코드 생성 금지

### 5.3 데이터 모델(권장)
- synonym_map
  - canonical_drug_id (FK -> golden_seed_items)
  - synonym_text (예: "DS-8201")
  - source (paper/clinicaltrials/patent)
  - confidence
  - created_at

### 5.4 golden_seed_items에 synonyms 배열 추가(추가 권장)
- `synonyms text[]`  
  예: ['Enhertu', 'DS-8201', 'Trastuzumab deruxtecan', 'T-DXd']
- 용도:
  - 검색 쿼리 확장(OR)
  - 벡터DB 메타데이터 필터 강화
  - UI에서 “동일약물 별칭” 한눈에 확인

---

## 6) Independent 축 관리: Sub-tag 강제(쓰레기통 방지, 필수)

### 6.1 정책
- `platform_axis = INDEPENDENT` 인 레코드는 **반드시 sub_class를 갖는다.**

### 6.2 Sub-class 예시(초기 세트)
- Independent (Trodelvy-like / SN-38)
- Independent (PBD)
- Independent (Topoisomerase I inhibitor - non-DXd)
- Independent (Novel payload)
- Independent (Other - requires review)

### 6.3 LLM 프롬프트 규칙(강제)
- "Vedotin, DXd, OptiDC에 속하지 않는다면, payload를 규명하고 Independent sub-class를 제안하라.  
   payload가 불명확하면 evidence 부족으로 표시하고 confidence를 낮춰라."

---

## 7) One-Click Review UI/UX: 검수 피로도 최소화(필수)

### 7.1 Diff View(변경점 강조 + 근거 하이라이트)
- 좌측: 템플릿 필드(예: DAR: 7.4)
- 우측: 근거 문단(…drug-to-antibody ratio of approximately **7.4** was observed…)
- 동작:
  - 우측 문단 클릭 → 좌측 필드에 “Approve” 또는 “Apply” (자동 반영)
  - “Approve All High Confidence” 버튼 제공(>0.9 일괄 승인)

### 7.2 Confidence Color Coding(신뢰도 시각화)
- confidence > 0.90 : 녹색(검수 최소)
- 0.70 ~ 0.90 : 노랑(빠른 확인)
- < 0.70 : 주황/빨강(집중 검토)

### 7.3 Gate Checklist와 연동
- Gate에서 실패하는 항목은 자동으로 해당 필드/근거 패널로 스크롤/포커스

---

## 8) Gate Checklist(승격 조건) — 보완 버전(필수)

### 8.1 MVP Gate(권장)
1) Axis Assigned ✅
2) Target Resolved ✅
3) Construct Ready ✅
   - payload_family
   - linker_type
   - conjugation_method
4) Evidence ≥ 2 ✅ (서로 다른 타입 권장)
5) Evidence Grade ≥ B ✅
6) Outcome Consistent ✅
   - Approved → Success
   - Discontinued/Failed → Fail + failure_mode 필수

### 8.2 Verified Lock
- Final 승격 시 `is_verified=true`
- 수정 필요 시:
  - Unlock 대신 “새 버전 레코드 생성(Version bump)” 정책 권장

---

## 9) LLM 보조 채움(Enrichment) 실행 설계

### 9.1 기본 규칙(근거 기반 강제)
- LLM은 “지식으로 추정”하지 않고,
  1) 벡터DB에서 근거 chunk Top-K 검색
  2) 해당 chunk만 근거로 필드 값을 제안
  3) 각 필드는 provenance(근거 refs) 없으면 `unknown`

### 9.2 LLM 작업 타입
- Discovery: 축별 쿼리로 문서 수집 → 후보 drug/program 추출 → Draft 레코드 생성
- Enrich: 특정 Draft 레코드의 템플릿 필드 자동 채움 + provenance 연결
- Evidence Expand: evidence 부족 시 추가 근거 탐색
- Failure Struct: 중단/실패 이유 표준 failure_mode로 구조화

### 9.3 출력(JSON) 표준(요약)
- 필드: value + confidence + evidence_refs
- evidence_items: 다건 생성
- notes: 불확실성/누락 이유 기록

---

## 10) DB 스키마(보완 포함) — 논리 모델

### 10.1 golden_seed_items (확장)
- platform_axis (ENUM/TEXT)
- independent_subclass (TEXT, axis=INDEPENDENT일 때 필수)
- payload_family, payload_specific
- linker_type, conjugation_method, dar_range
- clinical_stage, program_status, outcome
- failure_mode, key_failure_signal, discontinued_reason_summary
- evidence_grade, curation_level(Draft/Manual/Review/Final)
- is_verified, reviewed_by, reviewed_at
- synonyms TEXT[] (추가 권장)

### 10.2 evidence_items (1:N)
- id, golden_seed_item_id(FK)
- type(clinicaltrials/paper/patent/label/press/other)
- id_or_url, title, published_date, snippet

### 10.3 field_provenance (추적성 핵심)
- id, golden_seed_item_id(FK)
- field_name, field_value
- evidence_item_id(FK)
- confidence, quote_span(optional), note

### 10.4 synonym_map (중복 방지 핵심)
- id, canonical_drug_id(FK)
- synonym_text
- source_type, source_url
- confidence, created_at

### 10.5 llm_jobs
- id, job_type(discovery/enrich/evidence_expand/failure_struct)
- golden_seed_item_id(nullable)
- status(queued/running/done/failed)
- input_payload/output_payload JSONB
- error_message, timestamps

---

## 11) 구현 순서(실행 플랜)

### Phase 1 (즉시): 검수/승격을 위한 품질 체계
1) DB 확장: evidence_items, field_provenance, synonym_map, synonyms[]
2) Gate Checklist 업데이트 + Independent subclass 강제
3) Evidence 다건 UI + “근거 보기” 패널
4) confidence color coding + “Approve high confidence” 버튼

### Phase 2: LLM Enrich(필드 채움) 연결
1) llm_jobs + Enrich API
2) 벡터DB 검색 → LLM 추출 → Draft 자동 채움
3) Diff View로 One-Click Review 완성

### Phase 3: Discovery(축별 후보 자동 생성) + 정밀 쿼리 적용
1) 축별 쿼리(공통 NOT 포함)로 evidence_chunks 확보
2) synonym resolution 후 후보 생성
3) Auto 탭에 Draft 적재 → 사람은 Review/Final로 승격

### Phase 4: 실패/특허 감시 고도화
- 실패 데이터레이크 확대 + 유사 실패 추천
- 특허 변형 탐지 + 알림/요약

---

## 12) 운영 체크(팀 규칙)
- Draft는 무한히 생성 가능하지만, Final은 Gate 통과 + Verified만 허용  
- provenance 없는 필드는 unknown 유지(그럴듯한 추정 금지)  
- Independent는 subclass 없으면 Final 승격 금지  
- synonym_map 없으면 중복 레코드 증가 → Discovery 전에 반드시 수행  

(끝)
